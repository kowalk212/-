<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>í•œíˆ¬ ìë™ë§¤ë§¤ Pro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, sans-serif; 
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #0f172a 100%); 
            min-height: 100vh; 
            color: white; 
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .card { 
            background: rgba(255,255,255,0.1); 
            backdrop-filter: blur(10px); 
            border-radius: 16px; 
            padding: 20px; 
            margin-bottom: 20px; 
            border: 1px solid rgba(255,255,255,0.2);
        }
        .title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .badge { 
            display: inline-block; 
            padding: 8px 16px; 
            border-radius: 8px; 
            font-size: 14px; 
            font-weight: bold; 
            margin: 5px;
        }
        .badge-green { background: rgba(34,197,94,0.3); color: #86efac; }
        .badge-red { background: rgba(239,68,68,0.3); color: #fca5a5; }
        .btn { 
            padding: 12px 24px; 
            border: none; 
            border-radius: 12px; 
            font-weight: bold; 
            cursor: pointer; 
            margin: 5px;
            font-size: 14px;
        }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #22c55e; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat { padding: 20px; border-radius: 12px; color: white; }
        .stat-label { font-size: 12px; opacity: 0.9; margin-bottom: 8px; }
        .stat-value { font-size: 24px; font-weight: bold; }
        .bg-blue { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .bg-purple { background: linear-gradient(135deg, #a855f7, #7e22ce); }
        .bg-green { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .bg-red { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .bg-orange { background: linear-gradient(135deg, #f97316, #ea580c); }
        .log { 
            font-family: monospace; 
            font-size: 12px; 
            padding: 8px; 
            background: rgba(0,0,0,0.3); 
            border-radius: 4px; 
            margin: 4px 0;
            color: #86efac;
        }
        .list { max-height: 300px; overflow-y: auto; }
        .error { background: rgba(239,68,68,0.2); color: #fca5a5; }
        .success { background: rgba(34,197,94,0.2); color: #86efac; }
        select { 
            width: 100%; 
            padding: 12px; 
            background: rgba(255,255,255,0.1); 
            border: 1px solid rgba(255,255,255,0.2); 
            border-radius: 8px; 
            color: white; 
            font-size: 14px;
            margin-bottom: 10px;
        }
        select option { background: #1e293b; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="title">ğŸš€ í•œíˆ¬ ìë™ë§¤ë§¤ Pro</div>
            <div>
                <span class="badge" id="statusBadge">â³ ì—°ê²° ì¤‘...</span>
                <span class="badge badge-red" id="marketStatus">ğŸ”´ ì¥ ë§ˆê°</span>
                <span class="badge" id="autoMode">ğŸ¤– ìë™ëª¨ë“œ</span>
            </div>
            <div style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="connectAPI()">ğŸ”„ API ì—°ê²°</button>
                <button class="btn btn-success" onclick="startTrading()" id="startBtn" disabled>â–¶ ì‹œì‘</button>
                <button class="btn btn-danger" onclick="stopTrading()" id="stopBtn" disabled>â¸ ì •ì§€</button>
            </div>
        </div>

        <div class="grid">
            <div class="stat bg-blue">
                <div class="stat-label">ğŸ’µ ì˜ˆìˆ˜ê¸ˆ</div>
                <div class="stat-value" id="balance">0ì›</div>
            </div>
            <div class="stat bg-purple">
                <div class="stat-label">ğŸ“Š ì´ í‰ê°€ì•¡</div>
                <div class="stat-value" id="totalAssets">0ì›</div>
            </div>
            <div class="stat bg-green" id="profitCard">
                <div class="stat-label">ğŸ’° í‰ê°€ì†ìµ</div>
                <div class="stat-value" id="profitLoss">0ì›</div>
            </div>
            <div class="stat bg-orange">
                <div class="stat-label">ğŸ“ˆ ê±°ë˜ íšŸìˆ˜</div>
                <div class="stat-value" id="tradeCount">0íšŒ</div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-bottom: 15px;">âš™ï¸ ë§¤ë§¤ ì„¤ì •</h3>
            <label style="display: block; margin-bottom: 5px; font-size: 14px;">ì¢…ëª© ì„ íƒ</label>
            <select id="stockSelect">
                <option value="005930">ì‚¼ì„±ì „ì</option>
                <option value="000660">SKí•˜ì´ë‹‰ìŠ¤</option>
                <option value="035420">NAVER</option>
                <option value="035720">ì¹´ì¹´ì˜¤</option>
                <option value="005380">í˜„ëŒ€ì°¨</option>
            </select>
            <div class="grid" style="grid-template-columns: 1fr 1fr;">
                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px;">
                    <div style="font-size: 12px; opacity: 0.8;">í˜„ì¬ê°€</div>
                    <div style="font-size: 18px; font-weight: bold;" id="currentPrice">-ì›</div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px;">
                    <div style="font-size: 12px; opacity: 0.8;">RSI</div>
                    <div style="font-size: 18px; font-weight: bold;" id="rsiValue">-</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-bottom: 15px;">ğŸ“‹ ì‹œìŠ¤í…œ ë¡œê·¸</h3>
            <div class="list" id="logContainer">
                <div class="log">âœ¨ ì‹œìŠ¤í…œ ì‹œì‘...</div>
            </div>
        </div>
    </div>

    <script>
        let state = {
            token: '',
            connected: false,
            running: false,
            autoMode: true,
            selectedStock: '005930',
            balance: 0,
            totalAssets: 0,
            profitLoss: 0,
            tradeCount: 0
        };

        function addLog(msg, type = 'info') {
            const logDiv = document.getElementById('logContainer');
            const log = document.createElement('div');
            log.className = 'log ' + (type === 'error' ? 'error' : type === 'success' ? 'success' : '');
            log.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logDiv.insertBefore(log, logDiv.firstChild);
            
            while (logDiv.children.length > 50) {
                logDiv.removeChild(logDiv.lastChild);
            }
        }

        async function connectAPI() {
            try {
                addLog('ğŸ” API í† í° ë°œê¸‰ ì¤‘...');
                
                const response = await fetch('/api/token', {
                    method: 'POST'
                });

                const data = await response.json();
                
                if (data.success) {
                    state.token = data.token;
                    state.connected = true;
                    
                    document.getElementById('statusBadge').className = 'badge badge-green';
                    document.getElementById('statusBadge').textContent = 'âœ“ ì—°ê²°ë¨';
                    document.getElementById('startBtn').disabled = false;
                    
                    addLog('âœ… API ì—°ê²° ì„±ê³µ!', 'success');
                    await getAccount();
                } else {
                    throw new Error(data.error || 'í† í° ë°œê¸‰ ì‹¤íŒ¨');
                }
            } catch (error) {
                addLog('âŒ API ì—°ê²° ì‹¤íŒ¨: ' + error.message, 'error');
                state.connected = false;
                document.getElementById('statusBadge').className = 'badge badge-red';
                document.getElementById('statusBadge').textContent = 'âœ— ì—°ê²° ì‹¤íŒ¨';
            }
        }

        async function getAccount() {
            try {
                addLog('ğŸ’° ê³„ì¢Œ ì •ë³´ ì¡°íšŒ ì¤‘...');
                
                const response = await fetch('/api/account', {
                    headers: {
                        'Authorization': `Bearer ${state.token}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    state.balance = data.balance;
                    state.totalAssets = data.totalAssets;
                    state.profitLoss = data.profitLoss;

                    document.getElementById('balance').textContent = state.balance.toLocaleString() + 'ì›';
                    document.getElementById('totalAssets').textContent = state.totalAssets.toLocaleString() + 'ì›';
                    document.getElementById('profitLoss').textContent = (state.profitLoss >= 0 ? '+' : '') + state.profitLoss.toLocaleString() + 'ì›';
                    
                    const profitCard = document.getElementById('profitCard');
                    profitCard.className = 'stat ' + (state.profitLoss >= 0 ? 'bg-green' : 'bg-red');

                    addLog(`âœ… ê³„ì¢Œ ì¡°íšŒ ì„±ê³µ - ì˜ˆìˆ˜ê¸ˆ: ${state.balance.toLocaleString()}ì›`, 'success');
                } else {
                    throw new Error(data.error || 'ê³„ì¢Œ ì¡°íšŒ ì‹¤íŒ¨');
                }
            } catch (error) {
                addLog('âŒ ê³„ì¢Œ ì¡°íšŒ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        async function getPrice() {
            try {
                const response = await fetch(`/api/price?code=${state.selectedStock}`, {
                    headers: {
                        'Authorization': `Bearer ${state.token}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('currentPrice').textContent = data.price.toLocaleString() + 'ì›';
                    document.getElementById('rsiValue').textContent = data.rsi || '-';
                }
            } catch (error) {
                console.error('ê°€ê²© ì¡°íšŒ ì˜¤ë¥˜:', error);
            }
        }

        function startTrading() {
            if (!state.connected) {
                addLog('âš ï¸ APIê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            state.running = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            addLog('ğŸš€ ìë™ë§¤ë§¤ ì‹œì‘!', 'success');
            
            setInterval(() => {
                if (state.running && state.connected) {
                    getPrice();
                }
            }, 5000);
        }

        function stopTrading() {
            state.running = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            addLog('â¸ï¸ ìë™ë§¤ë§¤ ì¤‘ì§€', 'success');
        }

        function checkMarketStatus() {
            const now = new Date();
            const day = now.getDay();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const time = hour * 100 + minute;

            const statusBadge = document.getElementById('marketStatus');

            if (day === 0 || day === 6) {
                statusBadge.className = 'badge badge-red';
                statusBadge.textContent = 'ğŸ”´ ì£¼ë§';
            } else if (time >= 900 && time < 1530) {
                statusBadge.className = 'badge badge-green';
                statusBadge.textContent = 'ğŸŸ¢ ì¥ ì¤‘';
            } else {
                statusBadge.className = 'badge badge-red';
                statusBadge.textContent = 'ğŸ”´ ì¥ ë§ˆê°';
            }
        }

        document.getElementById('stockSelect').addEventListener('change', (e) => {
            state.selectedStock = e.target.value;
            if (state.connected) getPrice();
        });

        setInterval(checkMarketStatus, 1000);

        window.addEventListener('load', () => {
            addLog('âœ¨ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
            addLog('ğŸ’¡ "API ì—°ê²°" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.');
            checkMarketStatus();
            
            setTimeout(() => {
                connectAPI();
            }, 2000);
        });
    </script>
</body>
</html>
